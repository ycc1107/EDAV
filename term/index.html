<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>
<style type="text/css">

/* Legend Font Style */
body {
	font: 11px sans-serif;
	background-color: #ffffff;
}
        
/* Legend Position Style */
.legend {
	position:absolute;
	left:20px;
	top:30px;
}

.axis text {
	font: 10px sans-serif;
}

.axis line, .axis path {
	fill: none;
	stroke: #000;
	shape-rendering: crispEdges;
}
#state-borders {
  fill: none;
  stroke: #fff;
  stroke-width: 1.5px;
  stroke-linejoin: round;
  stroke-linecap: round;
  pointer-events: none;
}

.background {
  fill: none;
  pointer-events: all;
}

</style>
</head>
<body>
<script type="text/javascript">
		
//Width and height of map
var width = 960,
    height = 500,
    centered;

var lowColor = '#f9f9f9'
var highColor = '#bc2a66'

// D3 Projection
var projection = d3.geoAlbersUsa()
  .translate([width / 2, height / 2]) // translate to center of screen
  .scale([1000]); // scale things down so see entire US

// Define path generator
var path = d3.geoPath() // path generator that will convert GeoJSON to SVG paths
  .projection(projection); // tell path generator to use albersUsa projection

//Create SVG element and append map to the SVG
var svg = d3.select("body")
  .append("svg")
  .attr("width", width)
  .attr("height", height);

svg.append("rect")
  .attr("class", "background")
  .attr("width", width)
  .attr("height", height)
  .on("click", clicked);

var g = svg.append("g");
// Load in my states data!
data = [{'id': 'US.AK',
  'value': 90419900,
  'annual_inc': 80308.5939675003,
  'state': 'Alaska'},
 {'id': 'US.AL',
  'value': 400693650,
  'annual_inc': 71642.3228502759,
  'state': 'Alabama'},
 {'id': 'US.AR',
  'value': 240650500,
  'annual_inc': 73852.7448958075,
  'state': 'Arkansas'},
 {'id': 'US.AZ',
  'value': 780966125,
  'annual_inc': 73852.7280833603,
  'state': 'Arizona'},
 {'id': 'US.CA',
  'value': 4808480100,
  'annual_inc': 82726.6826846846,
  'state': 'California'},
 {'id': 'US.CO',
  'value': 727724225,
  'annual_inc': 83248.50853261,
  'state': 'Colorado'},
 {'id': 'US.CT',
  'value': 547556950,
  'annual_inc': 80668.8020259512,
  'state': 'Connecticut'},
 {'id': 'US.DC',
  'value': 84707250,
  'annual_inc': 78400.9106642555,
  'state': 'District of Columbia'},
 {'id': 'US.DE',
  'value': 96450975,
  'annual_inc': 71597.3817956805,
  'state': 'Delaware'},
 {'id': 'US.FL',
  'value': 2333034500,
  'annual_inc': 77841.0770031554,
  'state': 'Florida'},
 {'id': 'US.GA',
  'value': 1136790825,
  'annual_inc': 73253.1866119655,
  'state': 'Georgia'},
 {'id': 'US.HI',
  'value': 169562100,
  'annual_inc': 73234.3930414125,
  'state': 'Hawaii'},
 {'id': 'US.IA',
  'value': 114075,
  'annual_inc': 45680.9259259259,
  'state': 'Iowa'},
 {'id': 'US.ID',
  'value': 62088425,
  'annual_inc': 69713.7935308671,
  'state': 'Idaho'},
 {'id': 'US.IL',
  'value': 1410451950,
  'annual_inc': 75899.1891143052,
  'state': 'Illinois'},
 {'id': 'US.IN',
  'value': 550776675,
  'annual_inc': 70347.0153710529,
  'state': 'Indiana'},
 {'id': 'US.KS',
  'value': 283877825,
  'annual_inc': 67195.4356966792,
  'state': 'Kansas'},
 {'id': 'US.KY',
  'value': 313557625,
  'annual_inc': 76430.0588248011,
  'state': 'Kentucky'},
 {'id': 'US.LA',
  'value': 382046275,
  'annual_inc': 74013.2355712326,
  'state': 'Louisiana'},
 {'id': 'US.MA',
  'value': 811746725,
  'annual_inc': 82397.1180432519,
  'state': 'Massachusetts'},
 {'id': 'US.MD',
  'value': 856883500,
  'annual_inc': 87134.5724468456,
  'state': 'Maryland'},
 {'id': 'US.ME',
  'value': 73320525,
  'annual_inc': 80123.7623273123,
  'state': 'Maine'},
 {'id': 'US.MI',
  'value': 841646100,
  'annual_inc': 71009.8579483019,
  'state': 'Michigan'},
 {'id': 'US.MN',
  'value': 577447675,
  'annual_inc': 73039.7652920996,
  'state': 'Minnesota'},
 {'id': 'US.MO',
  'value': 524098650,
  'annual_inc': 70381.3933313023,
  'state': 'Missouri'},
 {'id': 'US.MS',
  'value': 186427150,
  'annual_inc': 72094.1089683803,
  'state': 'Mississippi'},
 {'id': 'US.MT',
  'value': 88170825,
  'annual_inc': 67652.8589292494,
  'state': 'Montana'},
 {'id': 'US.NC',
  'value': 930436100,
  'annual_inc': 77786.4626476083,
  'state': 'North Carolina'},
 {'id': 'US.ND',
  'value': 55622875,
  'annual_inc': 82642.7942194659,
  'state': 'North Dakota'},
 {'id': 'US.NE',
  'value': 110941450,
  'annual_inc': 70454.5048195142,
  'state': 'Nebraska'},
 {'id': 'US.NH',
  'value': 166469500,
  'annual_inc': 69431.3517202327,
  'state': 'New Hampshire'},
 {'id': 'US.NJ',
  'value': 1316207975,
  'annual_inc': 80768.2639919107,
  'state': 'New Jersey'},
 {'id': 'US.NM',
  'value': 178280525,
  'annual_inc': 76395.5578288221,
  'state': 'New Mexico'},
 {'id': 'US.NV',
  'value': 470165300,
  'annual_inc': 77936.8741552258,
  'state': 'Nevada'},
 {'id': 'US.NY',
  'value': 2767160700,
  'annual_inc': 84761.2655584005,
  'state': 'New York'},
 {'id': 'US.OH',
  'value': 1077142925,
  'annual_inc': 67172.8588782119,
  'state': 'Ohio'},
 {'id': 'US.OK',
  'value': 310665375,
  'annual_inc': 80119.9643976538,
  'state': 'Oklahoma'},
 {'id': 'US.OR',
  'value': 379466875,
  'annual_inc': 73657.1218454514,
  'state': 'Oregon'},
 {'id': 'US.PA',
  'value': 1131987950,
  'annual_inc': 75470.3154268847,
  'state': 'Pennsylvania'},
 {'id': 'US.RI',
  'value': 142960100,
  'annual_inc': 67301.7315912515,
  'state': 'Rhode Island'},
 {'id': 'US.SC',
  'value': 418481900,
  'annual_inc': 67974.9036346953,
  'state': 'South Carolina'},
 {'id': 'US.SD',
  'value': 64670375,
  'annual_inc': 86676.0159802623,
  'state': 'South Dakota'},
 {'id': 'US.TN',
  'value': 522342125,
  'annual_inc': 76674.5996341349,
  'state': 'Tennessee'},
 {'id': 'US.TX',
  'value': 2931133525,
  'annual_inc': 79483.6240184536,
  'state': 'Texas'},
 {'id': 'US.UT',
  'value': 227578525,
  'annual_inc': 79359.8837797211,
  'state': 'Utah'},
 {'id': 'US.VA',
  'value': 1013015875,
  'annual_inc': 76303.3131353079,
  'state': 'Virginia'},
 {'id': 'US.VT',
  'value': 68206775,
  'annual_inc': 81102.9061725073,
  'state': 'Vermont'},
 {'id': 'US.WA',
  'value': 721608300,
  'annual_inc': 72532.1141841345,
  'state': 'Washington'},
 {'id': 'US.WI',
  'value': 431766050,
  'annual_inc': 71889.6322712494,
  'state': 'Wisconsin'},
 {'id': 'US.WV',
  'value': 125954800,
  'annual_inc': 71006.6805668772,
  'state': 'West Virginia'},
 {'id': 'US.WY',
  'value': 74153325,
  'annual_inc': 72219.1898856689,
  'state': 'Wyoming'}]
// d3.csv("statesdata.csv", function(data) {
	var dataArray = [];
	for (var d = 0; d < data.length; d++) {
		dataArray.push(parseFloat(data[d].value))
	}
	var minVal = d3.min(dataArray)
	var maxVal = d3.max(dataArray)
	var ramp = d3.scaleLinear().domain([minVal,maxVal]).range([lowColor,highColor])
	
  // Load GeoJSON data and merge with states data
d3.json("us-states.json", function(json) {

  // Loop through each state data value in the .csv file
  for (var i = 0; i < data.length; i++) {

    // Grab State Name
    var dataState = data[i].state;

    // Grab data value 
    var dataValue = data[i].value;

    // Find the corresponding state inside the GeoJSON
    for (var j = 0; j < json.features.length; j++) {
      var jsonState = json.features[j].properties.name;

      if (dataState == jsonState) {

        // Copy the data value into the JSON
        json.features[j].properties.value = dataValue;

        // Stop looking through the JSON
        break;
      }
    }
  }

  // Bind the data to the SVG and create one path per GeoJSON feature
  g.append("g")
      .attr("id", "states")
      .selectAll("path")
    .data(json.features)
    .enter()
    .append("path")
    .attr("d", path)
    .style("stroke", "#fff")
    .style("stroke-width", "1")
    .style("fill", function(d) { return ramp(d.properties.value) })
    .on("click", clicked);

    g.append("path")
      .datum(topojson.mesh(json, json.objects.states, function(a, b) { return a !== b; }))
      .attr("id", "state-borders")
      .attr("d", path);
  
  // // add a legend
  // var w = 140, h = 300;

  // var key = d3.select("body")
  //   .append("svg")
  //   .attr("width", w)
  //   .attr("height", h)
  //   .attr("class", "legend");

  // var legend = key.append("defs")
  //   .append("svg:linearGradient")
  //   .attr("id", "gradient")
  //   .attr("x1", "100%")
  //   .attr("y1", "0%")
  //   .attr("x2", "100%")
  //   .attr("y2", "100%")
  //   .attr("spreadMethod", "pad");

  // legend.append("stop")
  //   .attr("offset", "0%")
  //   .attr("stop-color", highColor)
  //   .attr("stop-opacity", 1);
    
  // legend.append("stop")
  //   .attr("offset", "100%")
  //   .attr("stop-color", lowColor)
  //   .attr("stop-opacity", 1);

  // key.append("rect")
  //   .attr("width", w - 100)
  //   .attr("height", h)
  //   .style("fill", "url(#gradient)")
  //   .attr("transform", "translate(0,10)");

  // var y = d3.scaleLinear()
  //   .range([h, 0])
  //   .domain([minVal, maxVal]);

  // var yAxis = d3.axisRight(y);

  // key.append("g")
  //   .attr("class", "y axis")
  //   .attr("transform", "translate(41,10)")
  //   .call(yAxis)
});
function clicked(d) {
  var x, y, k;

  if (d && centered !== d) {
    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];
    k = 4;
    centered = d;
  } else {
    x = width / 2;
    y = height / 2;
    k = 1;
    centered = null;
  }

  g.selectAll("path")
      .classed("active", centered && function(d) { return d === centered; });

  g.transition()
      .duration(750)
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
      .style("stroke-width", 1.5 / k + "px");
}
// });
</script>
</body>
</html>